<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Paul Hegedus" />


<title>Analysis: sec1east</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">ESA2020-Hegedus</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Methods
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="methods.html">Overview</a>
    </li>
    <li>
      <a href="data_prep.html">Data Preparation</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Field Analysis</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="analysis_sec1east.html">sec1east</a>
        </li>
        <li>
          <a href="analysis_sec1west.html">sec1west</a>
        </li>
        <li>
          <a href="analysis_sec35mid.html">sec35middle</a>
        </li>
        <li>
          <a href="analysis_carlinwest.html">carlinwest</a>
        </li>
        <li>
          <a href="analysis_henrys.html">henrys</a>
        </li>
        <li>
          <a href="analysis_minnies.html">minnies</a>
        </li>
        <li>
          <a href="analysis_sre910.html">sre910</a>
        </li>
        <li>
          <a href="analysis_gramsmoms.html">gramsmoms</a>
        </li>
        <li>
          <a href="analysis_sre1314.html">sre1314</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
<li>
  <a href="resultsNdiscussion.html">Results &amp; Discussion</a>
</li>
<li>
  <a href="references.html">References</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Analysis: sec1east</h1>
<h4 class="author">Paul Hegedus</h4>

</div>


<p>This page documents the field specific analysis of ‘sec1east’. This includes analysis for both years of experimentation. Data is split into training and validation datasets using 60 and 40 percent of the data, respectively. For each year, each model is fit to the response variable using backwards AIC based model selection. The final model is used to predict the response variable (yield, protein, net-return) in the validation dataset and for calculating a RMSE for each model. Each variable is then adjusted +/-10% and the response is predicted and compared to the default predictions to determine the most elastic covariates related to each response variable.</p>
<p>For each final model, the AIC and RMSE are recorded in a table with the field, year, AIC, RMSE, and resposne variable. The most sensitive parameters for each model, resposne variable, and year are also recorded. These are used to asses patterns in drivers of the response variable between years in the same field and between fields in the same year, see <a href="esa_analysis.html">ESA Analysis</a>.</p>
<pre class="r"><code>library(magrittr)
library(ggplot2)
library(dplyr)
source(&quot;R/importCleanSelectFuns.R&quot;)
source(&quot;R/analysisFuns.R&quot;)

field_name &lt;- &quot;sec1east&quot;
output &lt;- data.frame(field = rep(field_name, 6), year = NA, model = NA, 
                     response = NA, RMSE = NA, AIC = NA)


out_folder &lt;- paste0(&quot;results/&quot;, field_name,&quot; /&quot;) 
field_dat &lt;- list.files(&quot;prepped&quot;)[grepl(field_name, list.files(&quot;prepped&quot;))]</code></pre>
<div id="sec1east" class="section level1">
<h1>2019 sec1east</h1>
<p>Analysis for the most recent year on record for the field. The section below imports the data from the specified field and year, explores the relationship between each response and as-applied N, and evaluates the correlations between covariates and responses. Depending on the correlations between parameters, covariates may be omitted. Data is centered if desired, and then 60% of the data is used for training and 40% is used for validation.</p>
<pre class="r"><code>year &lt;- &quot;2019&quot;
raw_name &lt;- field_dat[grepl(year, field_dat)]</code></pre>
<div id="import-and-explore-data" class="section level2">
<h2>Import and Explore Data</h2>
<p>Import the specified field and year data and summarize the data. See exploratory figures for response variables plotted against each explanatory variable.</p>
<pre class="r"><code>dat &lt;- impDat(raw_name, &quot;prepped&quot;)
summary(dat)</code></pre>
<pre><code>##     field                 x                y              farmer               year        prev_year   
##  Length:7725        Min.   :640987   Min.   :5099407   Length:7725        Min.   :2019   Min.   :2017  
##  Class :character   1st Qu.:641267   1st Qu.:5099827   Class :character   1st Qu.:2019   1st Qu.:2017  
##  Mode  :character   Median :641447   Median :5100097   Mode  :character   Median :2019   Median :2017  
##                     Mean   :641431   Mean   :5100082                      Mean   :2019   Mean   :2017  
##                     3rd Qu.:641607   3rd Qu.:5100367                      3rd Qu.:2019   3rd Qu.:2017  
##                     Max.   :641797   Max.   :5100617                      Max.   :2019   Max.   :2017  
##                                                                                                        
##       yld            prev_yld           aa_n          prev_aa_n        aspect_rad         slope     
##  Min.   :  0.83   Min.   :  4.53   Min.   :  0.00   Min.   :  0.00   Min.   :0.3533   Min.   :0.00  
##  1st Qu.: 67.46   1st Qu.: 50.75   1st Qu.: 72.81   1st Qu.: 39.35   1st Qu.:1.3520   1st Qu.:0.00  
##  Median : 80.54   Median : 62.91   Median :128.15   Median : 56.93   Median :1.6724   Median :1.00  
##  Mean   : 80.26   Mean   : 64.85   Mean   :106.54   Mean   : 56.76   Mean   :2.0145   Mean   :0.86  
##  3rd Qu.: 93.78   3rd Qu.: 78.27   3rd Qu.:128.98   3rd Qu.: 71.66   3rd Qu.:2.3572   3rd Qu.:1.00  
##  Max.   :139.73   Max.   :129.47   Max.   :195.27   Max.   :300.70   Max.   :5.7192   Max.   :6.00  
##                   NA&#39;s   :15                                                                        
##       elev           tpi             prec_cy      prec_py          gdd_cy          gdd_py    
##  Min.   :1227   Min.   :0.03724   Min.   :36   Min.   :372.0   Min.   :103.9   Min.   :2033  
##  1st Qu.:1233   1st Qu.:0.49373   1st Qu.:36   1st Qu.:372.0   1st Qu.:103.9   1st Qu.:2033  
##  Median :1235   Median :0.49917   Median :36   Median :375.0   Median :103.9   Median :2037  
##  Mean   :1235   Mean   :0.50488   Mean   :36   Mean   :373.9   Mean   :103.9   Mean   :2035  
##  3rd Qu.:1237   3rd Qu.:0.50808   3rd Qu.:36   3rd Qu.:375.0   3rd Qu.:103.9   3rd Qu.:2037  
##  Max.   :1239   Max.   :0.78716   Max.   :36   Max.   :375.0   Max.   :103.9   Max.   :2037  
##                                                                                              
##      veg_cy              veg_py          veg_2py              X                Y                pro       
##  Min.   :-0.003058   Min.   :0.1757   Min.   :0.09822   Min.   :640987   Min.   :5099407   Min.   : 5.01  
##  1st Qu.: 0.081985   1st Qu.:0.6782   1st Qu.:0.17279   1st Qu.:641267   1st Qu.:5099827   1st Qu.:10.94  
##  Median : 0.089593   Median :0.7358   Median :0.18398   Median :641447   Median :5100097   Median :12.07  
##  Mean   : 0.088388   Mean   :0.7164   Mean   :0.18324   Mean   :641431   Mean   :5100082   Mean   :11.94  
##  3rd Qu.: 0.096716   3rd Qu.:0.7806   3rd Qu.:0.19495   3rd Qu.:641607   3rd Qu.:5100367   3rd Qu.:12.95  
##  Max.   : 0.156866   Max.   :0.8266   Max.   :0.39829   Max.   :641797   Max.   :5100617   Max.   :20.00  
##                                                                                                           
##        NR        
##  Min.   :-139.2  
##  1st Qu.: 256.0  
##  Median : 328.8  
##  Mean   : 333.8  
##  3rd Qu.: 410.7  
##  Max.   : 846.0  
## </code></pre>
<p>Before looking at correlations, parameters with singular gradients are assessed and removed. At this point, the duplicate X and Y columns are removed.</p>
<pre class="r"><code>zv &lt;- apply(dat, 2, function(x) length(unique(x)) == 1)
dat &lt;- as.data.frame(dat)[, !zv] #(suppose df is the name of your dataset)
dat &lt;- dat[, -grep(&quot;X|Y&quot;, names(dat))]</code></pre>
<p>Now, explore correlations between variables within the dataset to assess any potential covariance issues between variables in analysis. A level of 0.7 is used as a threshold in which to remove a variable due to multicollinearity.</p>
<pre class="r"><code>cor_mat &lt;- dat %&gt;%
  as.matrix() %&gt;% 
  cor(use = &quot;pairwise.complete.obs&quot;) %&gt;%
  round(2)
psych::cor.plot(cor_mat, main=paste0(field_name,&quot; Correlation Matrix&quot;), upper=F)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Remove any covariates if necessary.</p>
<p>By default, all of the covariate data except latitude and longitude are centered to decrease the difference in magnitude between the scales of variables (i.e NDVI = 0 - 1, elev = 1500 - 2000). The response variables are also centered so that the variance from the mean is modeled. This allows inference on covariate influence on the variance of the responses around the mean.</p>
<pre class="r"><code>dfc &lt;- dat %&gt;% dplyr::select(-c(&quot;x&quot;, &quot;y&quot;))
for (i in 1:ncol(dfc)) {
  dfc[, i] &lt;- dfc[, i] - mean(dfc[, i], na.rm = T)
}
names(dfc) &lt;- paste0(&quot;cent_&quot;, names(dfc))
dat &lt;- cbind(dat, dfc)
rm(dfc) # save space in mem</code></pre>
<p>The last step before analysis is to split the data into training and validation datasets. 60% of the data is used for training models, while the validation dataset is reserved for assessing the ability of the final model to predict actual values.</p>
<pre class="r"><code>set.seed(1234)
dat_list &lt;- dualSplit(dat, 0.6)
dt &lt;- dat_list$trn
dv &lt;- dat_list$val
rm(dat_list) # save space in mem</code></pre>
</div>
<div id="generalized-additive-model" class="section level2">
<h2>Generalized Additive Model</h2>
<p>An initial model is tested that uses a generalized additive model with thin plate shrinkage splines. This combines the model fitting and selection process by allowing the estimated degrees of freedom for coefficients to shrink to zero if that parameter does not have an influence on the response.</p>
<div id="fit-models" class="section level4">
<h4>Fit Models</h4>
<p>Six GAM’s for this field are fit, one for each response (yield, protein, and net-return), and using the raw and centered data.</p>
<pre class="r"><code>modY0 &lt;- mgcv::bam(yld ~ s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modY0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yld ~ s(aa_n, bs = &quot;ts&quot;) + s(prev_aa_n, bs = &quot;ts&quot;) + s(aspect_rad, 
##     bs = &quot;ts&quot;) + s(slope, bs = &quot;ts&quot;) + s(elev, bs = &quot;ts&quot;) + s(tpi, 
##     bs = &quot;ts&quot;) + s(prec_py, bs = &quot;ts&quot;) + s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
##     s(veg_cy, bs = &quot;ts&quot;) + s(veg_py, bs = &quot;ts&quot;) + s(veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  80.1720     0.2202   364.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                     edf Ref.df       F  p-value    
## s(aa_n)       5.787e+00      9  89.414  &lt; 2e-16 ***
## s(prev_aa_n)  8.179e+00      9  54.636  &lt; 2e-16 ***
## s(aspect_rad) 8.239e+00      9  15.817  &lt; 2e-16 ***
## s(slope)      1.023e+00      9   2.580 5.00e-07 ***
## s(elev)       8.026e+00      9  17.683  &lt; 2e-16 ***
## s(tpi)        3.315e+00      9   2.216 5.28e-05 ***
## s(prec_py)    8.338e-01      2   2.508   0.0127 *  
## s(gdd_py)     4.794e-06      2   0.000   0.0128 *  
## s(veg_cy)     7.318e+00      9   4.360 5.78e-07 ***
## s(veg_py)     6.702e+00      9 108.536  &lt; 2e-16 ***
## s(veg_2py)    7.750e+00      9  41.320  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.495   Deviance explained = 50.1%
## fREML =  19259  Scale est. = 224.65    n = 4635</code></pre>
<pre class="r"><code>modY0_cent &lt;- mgcv::bam(yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modY0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  80.1720     0.2202   364.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## s(cent_aa_n)       5.787e+00      9  89.414  &lt; 2e-16 ***
## s(cent_prev_aa_n)  8.179e+00      9  54.636  &lt; 2e-16 ***
## s(cent_aspect_rad) 8.239e+00      9  15.817  &lt; 2e-16 ***
## s(cent_slope)      1.023e+00      9   2.580 5.00e-07 ***
## s(cent_elev)       8.026e+00      9  17.683  &lt; 2e-16 ***
## s(cent_tpi)        3.315e+00      9   2.216 5.28e-05 ***
## s(cent_prec_py)    8.338e-01      2   2.508   0.0127 *  
## s(cent_gdd_py)     4.794e-06      2   0.000   0.0128 *  
## s(cent_veg_cy)     7.318e+00      9   4.360 5.78e-07 ***
## s(cent_veg_py)     6.702e+00      9 108.536  &lt; 2e-16 ***
## s(cent_veg_2py)    7.750e+00      9  41.320  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.495   Deviance explained = 50.1%
## fREML =  19259  Scale est. = 224.65    n = 4635</code></pre>
<pre class="r"><code>modP0 &lt;- mgcv::bam(pro ~ s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modP0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## pro ~ s(aa_n, bs = &quot;ts&quot;) + s(prev_aa_n, bs = &quot;ts&quot;) + s(aspect_rad, 
##     bs = &quot;ts&quot;) + s(slope, bs = &quot;ts&quot;) + s(elev, bs = &quot;ts&quot;) + s(tpi, 
##     bs = &quot;ts&quot;) + s(prec_py, bs = &quot;ts&quot;) + s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
##     s(veg_cy, bs = &quot;ts&quot;) + s(veg_py, bs = &quot;ts&quot;) + s(veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 11.97768    0.01716   697.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                    edf Ref.df      F  p-value    
## s(aa_n)       7.646272      9 88.540  &lt; 2e-16 ***
## s(prev_aa_n)  7.743064      9  9.821  &lt; 2e-16 ***
## s(aspect_rad) 4.921027      9  8.693  &lt; 2e-16 ***
## s(slope)      1.139539      9  6.640 1.80e-15 ***
## s(elev)       8.386975      9 18.227  &lt; 2e-16 ***
## s(tpi)        0.565047      9  0.143 0.128174    
## s(prec_py)    0.005887      2  0.003 8.18e-07 ***
## s(gdd_py)     0.956522      2  9.751 7.51e-07 ***
## s(veg_cy)     0.963700      9  1.493 0.000135 ***
## s(veg_py)     4.690462      9  3.914 9.27e-08 ***
## s(veg_2py)    4.812515      9  6.158 9.94e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.421   Deviance explained = 42.6%
## fREML = 7397.8  Scale est. = 1.3652    n = 4635</code></pre>
<pre class="r"><code>modP0_cent &lt;- mgcv::bam(pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modP0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 11.97768    0.01716   697.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                         edf Ref.df      F  p-value    
## s(cent_aa_n)       7.646272      9 88.540  &lt; 2e-16 ***
## s(cent_prev_aa_n)  7.743064      9  9.821  &lt; 2e-16 ***
## s(cent_aspect_rad) 4.921027      9  8.693  &lt; 2e-16 ***
## s(cent_slope)      1.139539      9  6.640 1.80e-15 ***
## s(cent_elev)       8.386975      9 18.227  &lt; 2e-16 ***
## s(cent_tpi)        0.565047      9  0.143 0.128174    
## s(cent_prec_py)    0.005887      2  0.003 8.18e-07 ***
## s(cent_gdd_py)     0.956522      2  9.751 7.51e-07 ***
## s(cent_veg_cy)     0.963700      9  1.493 0.000135 ***
## s(cent_veg_py)     4.690462      9  3.914 9.27e-08 ***
## s(cent_veg_2py)    4.812515      9  6.158 9.94e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.421   Deviance explained = 42.6%
## fREML = 7397.8  Scale est. = 1.3652    n = 4635</code></pre>
<pre class="r"><code>modNR0 &lt;- mgcv::bam(NR ~ s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modNR0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## NR ~ s(aa_n, bs = &quot;ts&quot;) + s(prev_aa_n, bs = &quot;ts&quot;) + s(aspect_rad, 
##     bs = &quot;ts&quot;) + s(slope, bs = &quot;ts&quot;) + s(elev, bs = &quot;ts&quot;) + s(tpi, 
##     bs = &quot;ts&quot;) + s(prec_py, bs = &quot;ts&quot;) + s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
##     s(veg_cy, bs = &quot;ts&quot;) + s(veg_py, bs = &quot;ts&quot;) + s(veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  334.329      1.402   238.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                     edf Ref.df      F  p-value    
## s(aa_n)       6.858e+00      9 53.196  &lt; 2e-16 ***
## s(prev_aa_n)  8.093e+00      9 41.442  &lt; 2e-16 ***
## s(aspect_rad) 8.371e+00      9 19.455  &lt; 2e-16 ***
## s(slope)      7.233e-01      9  0.282    0.054 .  
## s(elev)       8.389e+00      9 20.259  &lt; 2e-16 ***
## s(tpi)        3.507e+00      9  2.179 8.04e-05 ***
## s(prec_py)    3.224e-01      2  0.238    0.216    
## s(gdd_py)     1.373e-05      2  0.000    0.216    
## s(veg_cy)     7.344e+00      9  4.166 1.39e-06 ***
## s(veg_py)     6.397e+00      9 84.158  &lt; 2e-16 ***
## s(veg_2py)    7.517e+00      9 30.337  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.447   Deviance explained = 45.4%
## fREML =  27842  Scale est. = 9113.5    n = 4635</code></pre>
<pre class="r"><code>modNR0_cent &lt;- mgcv::bam(NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modNR0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  334.329      1.402   238.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df      F  p-value    
## s(cent_aa_n)       6.858e+00      9 53.196  &lt; 2e-16 ***
## s(cent_prev_aa_n)  8.093e+00      9 41.442  &lt; 2e-16 ***
## s(cent_aspect_rad) 8.371e+00      9 19.455  &lt; 2e-16 ***
## s(cent_slope)      7.233e-01      9  0.282    0.054 .  
## s(cent_elev)       8.389e+00      9 20.259  &lt; 2e-16 ***
## s(cent_tpi)        3.507e+00      9  2.179 8.04e-05 ***
## s(cent_prec_py)    3.224e-01      2  0.238    0.216    
## s(cent_gdd_py)     1.373e-05      2  0.000    0.216    
## s(cent_veg_cy)     7.344e+00      9  4.166 1.39e-06 ***
## s(cent_veg_py)     6.397e+00      9 84.158  &lt; 2e-16 ***
## s(cent_veg_2py)    7.517e+00      9 30.337  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.447   Deviance explained = 45.4%
## fREML =  27842  Scale est. = 9113.5    n = 4635</code></pre>
</div>
<div id="check-diagnostics" class="section level4">
<h4>Check Diagnostics</h4>
<p>For each model fit, the diagnostics are checked to assess the assumptions of each model. These include linearity, normality of residuals, homogeneity of variance, and independence.</p>
<p>First make a directory to save outputs.</p>
<pre class="r"><code>cwd &lt;- paste0(&quot;results/&quot;, field_name, &quot;/diagnostics&quot;)
if (!file.exists(cwd)) {
  dir.create(cwd)
}</code></pre>
<p>Look at yield models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/yld_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modY0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 17 iterations.
## Gradient range [-6.345367e-07,2.339485e-08]
## (score 19259.35 &amp; scale 224.6533).
## Hessian positive definite, eigenvalue range [3.151718e-09,2317.044].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                     k&#39;      edf k-index p-value    
## s(aa_n)       9.00e+00 5.79e+00    0.93  &lt;2e-16 ***
## s(prev_aa_n)  9.00e+00 8.18e+00    0.65  &lt;2e-16 ***
## s(aspect_rad) 9.00e+00 8.24e+00    0.98   0.055 .  
## s(slope)      9.00e+00 1.02e+00    0.60  &lt;2e-16 ***
## s(elev)       9.00e+00 8.03e+00    0.96   0.010 ** 
## s(tpi)        9.00e+00 3.32e+00    0.97   0.010 ** 
## s(prec_py)    9.00e+00 8.34e-01    0.52  &lt;2e-16 ***
## s(gdd_py)     2.00e+00 4.79e-06    0.52  &lt;2e-16 ***
## s(veg_cy)     9.00e+00 7.32e+00    0.98   0.105    
## s(veg_py)     9.00e+00 6.70e+00    0.98   0.125    
## s(veg_2py)    9.00e+00 7.75e+00    0.99   0.225    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modY0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 17 iterations.
## Gradient range [-6.345367e-07,2.339485e-08]
## (score 19259.35 &amp; scale 224.6533).
## Hessian positive definite, eigenvalue range [3.151718e-09,2317.044].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                     k&#39;      edf k-index p-value    
## s(aa_n)       9.00e+00 5.79e+00    0.93  &lt;2e-16 ***
## s(prev_aa_n)  9.00e+00 8.18e+00    0.65  &lt;2e-16 ***
## s(aspect_rad) 9.00e+00 8.24e+00    0.98   0.060 .  
## s(slope)      9.00e+00 1.02e+00    0.60  &lt;2e-16 ***
## s(elev)       9.00e+00 8.03e+00    0.96  &lt;2e-16 ***
## s(tpi)        9.00e+00 3.32e+00    0.97   0.035 *  
## s(prec_py)    9.00e+00 8.34e-01    0.52  &lt;2e-16 ***
## s(gdd_py)     2.00e+00 4.79e-06    0.52  &lt;2e-16 ***
## s(veg_cy)     9.00e+00 7.32e+00    0.98   0.110    
## s(veg_py)     9.00e+00 6.70e+00    0.98   0.170    
## s(veg_2py)    9.00e+00 7.75e+00    0.99   0.220    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/yld_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modY0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 17 iterations.
## Gradient range [-6.345349e-07,2.339489e-08]
## (score 19259.35 &amp; scale 224.6533).
## Hessian positive definite, eigenvalue range [3.151719e-09,2317.044].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.79e+00    0.93  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 8.18e+00    0.65  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.24e+00    0.98   0.040 *  
## s(cent_slope)      9.00e+00 1.02e+00    0.60  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.03e+00    0.96   0.005 ** 
## s(cent_tpi)        9.00e+00 3.32e+00    0.97   0.050 *  
## s(cent_prec_py)    9.00e+00 8.34e-01    0.52  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 4.79e-06    0.52  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.32e+00    0.98   0.090 .  
## s(cent_veg_py)     9.00e+00 6.70e+00    0.98   0.135    
## s(cent_veg_2py)    9.00e+00 7.75e+00    0.99   0.160    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modY0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 17 iterations.
## Gradient range [-6.345349e-07,2.339489e-08]
## (score 19259.35 &amp; scale 224.6533).
## Hessian positive definite, eigenvalue range [3.151719e-09,2317.044].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.79e+00    0.93  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 8.18e+00    0.65  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.24e+00    0.98   0.055 .  
## s(cent_slope)      9.00e+00 1.02e+00    0.60  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.03e+00    0.96   0.010 ** 
## s(cent_tpi)        9.00e+00 3.32e+00    0.97   0.025 *  
## s(cent_prec_py)    9.00e+00 8.34e-01    0.52  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 4.79e-06    0.52  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.32e+00    0.98   0.090 .  
## s(cent_veg_py)     9.00e+00 6.70e+00    0.98   0.115    
## s(cent_veg_2py)    9.00e+00 7.75e+00    0.99   0.250    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Look at protein models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/pro_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modP0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 33 iterations.
## Gradient range [-6.635213e-05,6.973442e-05]
## (score 7397.752 &amp; scale 1.365189).
## Hessian positive definite, eigenvalue range [6.133381e-06,2317.028].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                    k&#39;     edf k-index p-value    
## s(aa_n)       9.00000 7.64627    0.95  &lt;2e-16 ***
## s(prev_aa_n)  9.00000 7.74306    0.79  &lt;2e-16 ***
## s(aspect_rad) 9.00000 4.92103    1.01    0.81    
## s(slope)      9.00000 1.13954    0.79  &lt;2e-16 ***
## s(elev)       9.00000 8.38697    0.99    0.35    
## s(tpi)        9.00000 0.56505    1.00    0.52    
## s(prec_py)    9.00000 0.00589    0.75  &lt;2e-16 ***
## s(gdd_py)     2.00000 0.95652    0.75  &lt;2e-16 ***
## s(veg_cy)     9.00000 0.96370    0.98    0.05 *  
## s(veg_py)     9.00000 4.69046    1.00    0.44    
## s(veg_2py)    9.00000 4.81252    1.01    0.87    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modP0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 33 iterations.
## Gradient range [-6.635213e-05,6.973442e-05]
## (score 7397.752 &amp; scale 1.365189).
## Hessian positive definite, eigenvalue range [6.133381e-06,2317.028].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                    k&#39;     edf k-index p-value    
## s(aa_n)       9.00000 7.64627    0.95  &lt;2e-16 ***
## s(prev_aa_n)  9.00000 7.74306    0.79  &lt;2e-16 ***
## s(aspect_rad) 9.00000 4.92103    1.01   0.675    
## s(slope)      9.00000 1.13954    0.79  &lt;2e-16 ***
## s(elev)       9.00000 8.38697    0.99   0.355    
## s(tpi)        9.00000 0.56505    1.00   0.460    
## s(prec_py)    9.00000 0.00589    0.75  &lt;2e-16 ***
## s(gdd_py)     2.00000 0.95652    0.75  &lt;2e-16 ***
## s(veg_cy)     9.00000 0.96370    0.98   0.055 .  
## s(veg_py)     9.00000 4.69046    1.00   0.390    
## s(veg_2py)    9.00000 4.81252    1.01   0.830    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/pro_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modP0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 33 iterations.
## Gradient range [-6.635279e-05,6.973512e-05]
## (score 7397.752 &amp; scale 1.365189).
## Hessian positive definite, eigenvalue range [6.133402e-06,2317.028].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 7.64627    0.95  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 7.74306    0.79  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 4.92103    1.01    0.70    
## s(cent_slope)      9.00000 1.13954    0.79  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.38697    0.99    0.33    
## s(cent_tpi)        9.00000 0.56505    1.00    0.52    
## s(cent_prec_py)    9.00000 0.00589    0.75  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.95652    0.75  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 0.96370    0.98    0.10    
## s(cent_veg_py)     9.00000 4.69046    1.00    0.44    
## s(cent_veg_2py)    9.00000 4.81252    1.01    0.84    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modP0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 33 iterations.
## Gradient range [-6.635279e-05,6.973512e-05]
## (score 7397.752 &amp; scale 1.365189).
## Hessian positive definite, eigenvalue range [6.133402e-06,2317.028].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 7.64627    0.95  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 7.74306    0.79  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 4.92103    1.01    0.74    
## s(cent_slope)      9.00000 1.13954    0.79  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.38697    0.99    0.36    
## s(cent_tpi)        9.00000 0.56505    1.00    0.52    
## s(cent_prec_py)    9.00000 0.00589    0.75  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.95652    0.75  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 0.96370    0.98    0.07 .  
## s(cent_veg_py)     9.00000 4.69046    1.00    0.36    
## s(cent_veg_2py)    9.00000 4.81252    1.01    0.86    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Look at net-return models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/NR_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modNR0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 14 iterations.
## Gradient range [-9.819522e-05,4.683465e-05]
## (score 27841.73 &amp; scale 9113.491).
## Hessian positive definite, eigenvalue range [7.952221e-09,2317.045].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                     k&#39;      edf k-index p-value    
## s(aa_n)       9.00e+00 6.86e+00    0.94  &lt;2e-16 ***
## s(prev_aa_n)  9.00e+00 8.09e+00    0.67  &lt;2e-16 ***
## s(aspect_rad) 9.00e+00 8.37e+00    0.97    0.01 ** 
## s(slope)      9.00e+00 7.23e-01    0.64  &lt;2e-16 ***
## s(elev)       9.00e+00 8.39e+00    0.95  &lt;2e-16 ***
## s(tpi)        9.00e+00 3.51e+00    0.97    0.02 *  
## s(prec_py)    9.00e+00 3.22e-01    0.55  &lt;2e-16 ***
## s(gdd_py)     2.00e+00 1.37e-05    0.55  &lt;2e-16 ***
## s(veg_cy)     9.00e+00 7.34e+00    0.99    0.22    
## s(veg_py)     9.00e+00 6.40e+00    0.99    0.16    
## s(veg_2py)    9.00e+00 7.52e+00    0.99    0.20    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modNR0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 14 iterations.
## Gradient range [-9.819522e-05,4.683465e-05]
## (score 27841.73 &amp; scale 9113.491).
## Hessian positive definite, eigenvalue range [7.952221e-09,2317.045].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                     k&#39;      edf k-index p-value    
## s(aa_n)       9.00e+00 6.86e+00    0.94  &lt;2e-16 ***
## s(prev_aa_n)  9.00e+00 8.09e+00    0.67  &lt;2e-16 ***
## s(aspect_rad) 9.00e+00 8.37e+00    0.97   0.030 *  
## s(slope)      9.00e+00 7.23e-01    0.64  &lt;2e-16 ***
## s(elev)       9.00e+00 8.39e+00    0.95   0.005 ** 
## s(tpi)        9.00e+00 3.51e+00    0.97   0.035 *  
## s(prec_py)    9.00e+00 3.22e-01    0.55  &lt;2e-16 ***
## s(gdd_py)     2.00e+00 1.37e-05    0.55  &lt;2e-16 ***
## s(veg_cy)     9.00e+00 7.34e+00    0.99   0.330    
## s(veg_py)     9.00e+00 6.40e+00    0.99   0.145    
## s(veg_2py)    9.00e+00 7.52e+00    0.99   0.225    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/NR_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)  
  par(mfrow=c(2,2))
  mgcv::gam.check(modNR0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 14 iterations.
## Gradient range [-9.819521e-05,4.68347e-05]
## (score 27841.73 &amp; scale 9113.491).
## Hessian positive definite, eigenvalue range [7.952219e-09,2317.045].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 6.86e+00    0.94  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 8.09e+00    0.67  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.37e+00    0.97   0.055 .  
## s(cent_slope)      9.00e+00 7.23e-01    0.64  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.39e+00    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 3.51e+00    0.97   0.040 *  
## s(cent_prec_py)    9.00e+00 3.22e-01    0.55  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 1.37e-05    0.55  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.34e+00    0.99   0.260    
## s(cent_veg_py)     9.00e+00 6.40e+00    0.99   0.140    
## s(cent_veg_2py)    9.00e+00 7.52e+00    0.99   0.240    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modNR0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 14 iterations.
## Gradient range [-9.819521e-05,4.68347e-05]
## (score 27841.73 &amp; scale 9113.491).
## Hessian positive definite, eigenvalue range [7.952219e-09,2317.045].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 6.86e+00    0.94  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 8.09e+00    0.67  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.37e+00    0.97   0.045 *  
## s(cent_slope)      9.00e+00 7.23e-01    0.64  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.39e+00    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 3.51e+00    0.97   0.005 ** 
## s(cent_prec_py)    9.00e+00 3.22e-01    0.55  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 1.37e-05    0.55  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.34e+00    0.99   0.235    
## s(cent_veg_py)     9.00e+00 6.40e+00    0.99   0.165    
## s(cent_veg_2py)    9.00e+00 7.52e+00    0.99   0.195    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="update-models" class="section level4">
<h4>Update Models</h4>
<p>Although there seems to be some heavy left tails in the normal qq-plots and violations of homogeneity of variance, we remind ourselves that the ultimate goal of these models is to make the best prediction, not necessarily the best interpretations. However, we are going to address the violation of the assumption of independence, because data closer to each other are more related than data farther apart from each other.</p>
<p>To take spatial autocorrelation into account, a gaussian process basis prediction function is used on the product of latitude and longitude.</p>
<pre class="r"><code>modY1 &lt;- mgcv::bam(yld ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modY1_cent &lt;- mgcv::bam(yld ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modP1 &lt;- mgcv::bam(pro ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modP1_cent &lt;- mgcv::bam(pro ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modNR1 &lt;- mgcv::bam(NR ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(aa_n, bs = &quot;ts&quot;) + 
                    s(prev_aa_n, bs = &quot;ts&quot;) + 
                    s(aspect_rad, bs = &quot;ts&quot;) + 
                    s(slope, bs = &quot;ts&quot;) +
                    s(elev, bs = &quot;ts&quot;) +
                    s(tpi, bs = &quot;ts&quot;) +
                    s(prec_py, bs = &quot;ts&quot;) +
                    s(gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(veg_cy, bs = &quot;ts&quot;) +
                    s(veg_py, bs = &quot;ts&quot;) +
                    s(veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modNR1_cent &lt;- mgcv::bam(NR ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
</div>
<div id="assess-models" class="section level4">
<h4>Assess Models</h4>
<p>To asses the predictive ability of each model, it is used to predict the response in the validation dataset. This allows us to calculate RMSE and make plots of the model fits compared to observed values.</p>
<pre class="r"><code>dv$gam_pred_yld &lt;- predict(modY1, dv)
dv$gam_pred_yld_cent &lt;- predict(modY1_cent, dv)
dv$gam_pred_pro &lt;- predict(modP1, dv)
dv$gam_pred_pro_cent &lt;- predict(modP1_cent, dv)
dv$gam_pred_NR &lt;- predict(modNR1, dv)
dv$gam_pred_NR_cent &lt;- predict(modNR1, dv)

plotVal(dv, &quot;yld&quot;, &quot;gam_pred_yld&quot;, field_name, year, modY1, TRUE)</code></pre>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_point).

## Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;yld&quot;, &quot;gam_pred_yld_cent&quot;, field_name, year, modY1_cent, TRUE)</code></pre>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_point).

## Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;pro&quot;, &quot;gam_pred_pro&quot;, field_name, year, modP1, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;pro&quot;, &quot;gam_pred_pro_cent&quot;, field_name, year, modP1_cent, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-4.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;NR&quot;, &quot;gam_pred_NR&quot;, field_name, year, modNR1, TRUE)</code></pre>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-5.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;NR&quot;, &quot;gam_pred_NR_cent&quot;, field_name, year, modNR1_cent, TRUE)</code></pre>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).

## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-20-6.png" width="672" /></p>
<p>Based on the fitted values, there does not appear to be any difference between models fit with raw or centered response variables, so raw values will be assessed. Now, plot the observed vs. predcited values and calculate RMSE.</p>
<pre class="r"><code>plotObsVPreds(dv, &quot;yld&quot;, &quot;gam_pred_yld&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;yld&quot;, &quot;gam_pred_yld_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;pro&quot;, &quot;gam_pred_pro&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;pro&quot;, &quot;gam_pred_pro_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-4.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;NR&quot;, &quot;gam_pred_NR&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-5.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;NR&quot;, &quot;gam_pred_NR_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-21-6.png" width="672" /></p>
</div>
<div id="save-outputs" class="section level4">
<h4>Save Outputs</h4>
<p>Now that each model has been fit, the RMSE and AIC of each is recorded for further analysis and comparison between years and across years. Again, because centering the responses results in the exact same model fits, it is omitted.</p>
<pre class="r"><code>rmses &lt;- c(round(Metrics::rmse(na.omit(dv$yld), na.omit(dv$gam_pred_yld)), 4),
           round(Metrics::rmse(na.omit(dv$pro), na.omit(dv$gam_pred_pro)), 4),
           round(Metrics::rmse(na.omit(dv$NR), na.omit(dv$gam_pred_NR)), 4))
aics &lt;- c(AIC(modY0), AIC(modP0), AIC(modNR0))
forOutput &lt;- data.frame(rep(field_name, 3), rep(year, 3), rep(&quot;GAM&quot;, 3),
                        c(&quot;Yield&quot;, &quot;Protein&quot;, &quot;Net-Return&quot;), rmses, aics)
# EDIT
output[1:3, ] &lt;- forOutput</code></pre>
</div>
<div id="sensitivity-analysis" class="section level4">
<h4>Sensitivity Analysis</h4>
<p>To perform the sensitivity analysis, each variable is increased or decreased by 10%. The resulting mean prediction across the field for the response is recorded and compared against the mean responses without adjustment. Sensitivity is calculated as the absolute value of the difference between the mean response of the default minus the mean response in the adjusted setting, over the mean response in the default system, divided by 0.1.</p>
<p>Make tables to hold sensitivity analysis results.</p>
<pre class="r"><code>covars &lt;- c(&quot;aa_n&quot;, &quot;aspect_rad&quot;, &quot;slope&quot;, &quot;elev&quot;,
            &quot;tpi&quot;, &quot;prec_py&quot;, &quot;gdd_py&quot;, &quot;veg_cy&quot;,
            &quot;veg_py&quot;, &quot;veg_2py&quot;)

yldSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(yldSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
yldSensTab$ResponseVar &lt;- &quot;yld&quot;
yldSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
yldSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))

proSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(proSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
proSensTab$ResponseVar &lt;- &quot;pro&quot;
proSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
proSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))


NRSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(NRSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
NRSensTab$ResponseVar &lt;- &quot;NR&quot;
NRSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
NRSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))</code></pre>
<p>Run sensitivity analysis.</p>
<pre class="r"><code>yldSensTab &lt;- sensitivity(yldSensTab, &quot;yld&quot;, dv, modY1)
proSensTab &lt;- sensitivity(proSensTab, &quot;pro&quot;, dv, modP1)
NRSensTab &lt;- sensitivity(NRSensTab, &quot;NR&quot;, dv, modNR1)</code></pre>
<p>Repeat for centered data.</p>
<pre class="r"><code>covars &lt;- c(&quot;cent_aa_n&quot;, &quot;cent_aspect_rad&quot;, &quot;cent_slope&quot;, &quot;cent_elev&quot;,
            &quot;cent_tpi&quot;, &quot;cent_prec_py&quot;, &quot;cent_gdd_py&quot;, &quot;cent_veg_cy&quot;,
            &quot;cent_veg_py&quot;, &quot;cent_veg_2py&quot;)

centyldSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centyldSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centyldSensTab$ResponseVar &lt;- &quot;yld&quot;
centyldSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centyldSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))

centproSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centproSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centproSensTab$ResponseVar &lt;- &quot;pro&quot;
centproSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centproSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))


centNRSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centNRSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centNRSensTab$ResponseVar &lt;- &quot;NR&quot;
centNRSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centNRSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))</code></pre>
<p>Run sensitivity analysis.</p>
<pre class="r"><code>centyldSensTab &lt;- sensitivity(centyldSensTab, &quot;yld&quot;, dv, modY1_cent)
centproSensTab &lt;- sensitivity(centproSensTab, &quot;pro&quot;, dv, modP1_cent)
centNRSensTab &lt;- sensitivity(centNRSensTab, &quot;NR&quot;, dv, modNR1_cent)</code></pre>
</div>
<div id="save-outputs-1" class="section level4">
<h4>Save Outputs</h4>
<pre class="r"><code>sensTable &lt;- rbind(yldSensTab, proSensTab, NRSensTab)
sensTable$field &lt;- field_name
data.table::fwrite(sensTable,
                   paste0(&quot;results/&quot;, field_name, &quot;/&quot;, 
                          field_name, &quot;_sensTable_&quot;, year))
sensTable &lt;- rbind(centyldSensTab, centproSensTab, centNRSensTab)
sensTable$field &lt;- field_name
data.table::fwrite(sensTable,
                   paste0(&quot;results/&quot;, field_name, &quot;/&quot;, 
                          field_name, &quot;_sensTableCent_&quot;, year))</code></pre>
</div>
</div>
</div>
<div id="sec1east-1" class="section level1">
<h1>2017 sec1east</h1>
<p>Analysis for the most recent year on record for the field. The section below imports the data from the specified field and year, explores the relationship between each response and as-applied N, and evaluates the correlations between covariates and responses. Depending on the correlations between parameters, covariates may be omitted. Data is centered if desired, and then 60% of the data is used for training and 40% is used for validation.</p>
<pre class="r"><code>year &lt;- &quot;2017&quot;
raw_name &lt;- field_dat[grepl(year, field_dat)]</code></pre>
<div id="import-and-explore-data-1" class="section level2">
<h2>Import and Explore Data</h2>
<p>Import the specified field and year data and summarize the data. See exploratory figures for response variables plotted against each explanatory variable.</p>
<pre class="r"><code>dat &lt;- impDat(raw_name, &quot;prepped&quot;)
summary(dat)</code></pre>
<pre><code>##     field                 x                y              farmer               year        prev_year   
##  Length:7925        Min.   :640987   Min.   :5099407   Length:7925        Min.   :2017   Min.   :2015  
##  Class :character   1st Qu.:641267   1st Qu.:5099837   Class :character   1st Qu.:2017   1st Qu.:2015  
##  Mode  :character   Median :641457   Median :5100107   Mode  :character   Median :2017   Median :2015  
##                     Mean   :641437   Mean   :5100088                      Mean   :2017   Mean   :2015  
##                     3rd Qu.:641617   3rd Qu.:5100367                      3rd Qu.:2017   3rd Qu.:2015  
##                     Max.   :641797   Max.   :5100617                      Max.   :2017   Max.   :2015  
##                                                                                                        
##       yld            prev_yld          aa_n          prev_aa_n       aspect_rad         slope       
##  Min.   :  0.01   Min.   : 0.46   Min.   :  0.00   Min.   : 0.00   Min.   :0.3533   Min.   :0.0000  
##  1st Qu.: 50.54   1st Qu.:29.34   1st Qu.: 39.37   1st Qu.:17.16   1st Qu.:1.3585   1st Qu.:0.0000  
##  Median : 62.79   Median :35.20   Median : 56.89   Median :17.24   Median :1.6828   Median :1.0000  
##  Mean   : 64.54   Mean   :34.02   Mean   : 56.68   Mean   :17.53   Mean   :2.0160   Mean   :0.8488  
##  3rd Qu.: 78.12   3rd Qu.:39.28   3rd Qu.: 71.59   3rd Qu.:17.31   3rd Qu.:2.3769   3rd Qu.:1.0000  
##  Max.   :129.47   Max.   :79.39   Max.   :300.70   Max.   :43.79   Max.   :5.7192   Max.   :6.0000  
##                   NA&#39;s   :1227                                                                      
##       elev           tpi             prec_cy         prec_py          gdd_cy          gdd_py    
##  Min.   :1227   Min.   :0.03724   Min.   :93.00   Min.   :387.0   Min.   :272.0   Min.   :2066  
##  1st Qu.:1233   1st Qu.:0.49373   1st Qu.:93.00   1st Qu.:387.0   1st Qu.:272.0   1st Qu.:2066  
##  Median :1235   Median :0.49925   Median :93.00   Median :387.0   Median :273.2   Median :2074  
##  Mean   :1235   Mean   :0.50476   Mean   :93.73   Mean   :389.2   Mean   :272.8   Mean   :2071  
##  3rd Qu.:1237   3rd Qu.:0.50833   3rd Qu.:95.00   3rd Qu.:393.0   3rd Qu.:273.2   3rd Qu.:2074  
##  Max.   :1239   Max.   :0.78716   Max.   :95.00   Max.   :393.0   Max.   :273.2   Max.   :2074  
##                                                                                                 
##      veg_cy             veg_py          veg_2py             X                Y                pro        
##  Min.   :-0.12432   Min.   :0.3321   Min.   :0.2692   Min.   :640987   Min.   :5099407   Min.   : 5.010  
##  1st Qu.:-0.09821   1st Qu.:0.7292   1st Qu.:0.7763   1st Qu.:641267   1st Qu.:5099837   1st Qu.: 8.975  
##  Median :-0.08163   Median :0.7503   Median :0.8416   Median :641457   Median :5100107   Median :10.261  
##  Mean   :-0.06532   Mean   :0.7441   Mean   :0.7946   Mean   :641437   Mean   :5100088   Mean   : 9.969  
##  3rd Qu.:-0.02591   3rd Qu.:0.7741   3rd Qu.:0.8555   3rd Qu.:641617   3rd Qu.:5100367   3rd Qu.:10.999  
##  Max.   : 0.09187   Max.   :0.8666   Max.   :0.8810   Max.   :641797   Max.   :5100617   Max.   :15.460  
##                                                                                                          
##        NR        
##  Min.   :-101.0  
##  1st Qu.: 143.0  
##  Median : 210.2  
##  Mean   : 221.2  
##  3rd Qu.: 292.3  
##  Max.   : 700.1  
## </code></pre>
<p>Before looking at correlations, parameters with singular gradients are assessed and removed. At this point, the duplicate X and Y columns are removed.</p>
<pre class="r"><code>zv &lt;- apply(dat, 2, function(x) length(unique(x)) == 1)
dat &lt;- as.data.frame(dat)[, !zv] #(suppose df is the name of your dataset)
dat &lt;- dat[, -grep(&quot;X|Y&quot;, names(dat))]</code></pre>
<p>Now, explore correlations between variables within the dataset to assess any potential covariance issues between variables in analysis. A level of 0.7 is used as a threshold in which to remove a variable due to multicollinearity.</p>
<pre class="r"><code>cor_mat &lt;- dat %&gt;%
  as.matrix() %&gt;% 
  cor(use = &quot;pairwise.complete.obs&quot;) %&gt;%
  round(2)
psych::cor.plot(cor_mat, main=paste0(field_name,&quot; Correlation Matrix&quot;), upper=F)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Remove any covariates if necessary.</p>
<p>By default, all of the covariate data except latitude and longitude are centered to decrease the difference in magnitude between the scales of variables (i.e NDVI = 0 - 1, elev = 1500 - 2000). The response variables are also centered so that the variance from the mean is modeled. This allows inference on covariate influence on the variance of the responses around the mean.</p>
<pre class="r"><code>dfc &lt;- dat %&gt;% dplyr::select(-c(&quot;x&quot;, &quot;y&quot;))
for (i in 1:ncol(dfc)) {
  dfc[, i] &lt;- dfc[, i] - mean(dfc[, i], na.rm = T)
}
names(dfc) &lt;- paste0(&quot;cent_&quot;, names(dfc))
dat &lt;- cbind(dat, dfc)
rm(dfc) # save space in mem</code></pre>
<p>The last step before analysis is to split the data into training and validation datasets. 60% of the data is used for training models, while the validation dataset is reserved for assessing the ability of the final model to predict actual values.</p>
<pre class="r"><code>dat_list &lt;- dualSplit(dat, 0.6)
dt &lt;- dat_list$trn
dv &lt;- dat_list$val
rm(dat_list) # save space in mem</code></pre>
</div>
<div id="generalized-additive-model-1" class="section level2">
<h2>Generalized Additive Model</h2>
<p>An initial model is tested that uses a generalized additive model with thin plate shrinkage splines. This combines the model fitting and selection process by allowing the estimated degrees of freedom for coefficients to shrink to zero if that parameter does not have an influence on the response.</p>
<div id="fit-models-1" class="section level4">
<h4>Fit Models</h4>
<p>Six GAM’s for this field are fit, one for each response (yield, protein, and net-return), and using the raw and centered data.</p>
<pre class="r"><code>modY0 &lt;- mgcv::bam(yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modY0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   64.612      0.185   349.3   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## s(cent_aa_n)       5.665e+00      9 116.917  &lt; 2e-16 ***
## s(cent_prev_aa_n)  4.528e+00      9   5.588 4.16e-11 ***
## s(cent_aspect_rad) 8.225e+00      9  42.921  &lt; 2e-16 ***
## s(cent_slope)      5.440e+00      9   7.347 2.37e-14 ***
## s(cent_elev)       8.252e+00      9  40.985  &lt; 2e-16 ***
## s(cent_tpi)        5.342e+00      9   5.955 1.13e-11 ***
## s(cent_prec_py)    5.056e-03      9   0.001 4.74e-09 ***
## s(cent_gdd_py)     9.753e-01      2  13.530 6.23e-09 ***
## s(cent_veg_cy)     7.037e+00      9  11.033  &lt; 2e-16 ***
## s(cent_veg_py)     7.187e-05      9   0.000    0.636    
## s(cent_veg_2py)    8.631e+00      9  86.335  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.573   Deviance explained = 57.8%
## fREML =  18985  Scale est. = 162.69    n = 4755</code></pre>
<pre class="r"><code>modY0_cent &lt;- mgcv::bam(yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modY0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yld ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   64.612      0.185   349.3   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## s(cent_aa_n)       5.665e+00      9 116.917  &lt; 2e-16 ***
## s(cent_prev_aa_n)  4.528e+00      9   5.588 4.16e-11 ***
## s(cent_aspect_rad) 8.225e+00      9  42.921  &lt; 2e-16 ***
## s(cent_slope)      5.440e+00      9   7.347 2.37e-14 ***
## s(cent_elev)       8.252e+00      9  40.985  &lt; 2e-16 ***
## s(cent_tpi)        5.342e+00      9   5.955 1.13e-11 ***
## s(cent_prec_py)    5.056e-03      9   0.001 4.74e-09 ***
## s(cent_gdd_py)     9.753e-01      2  13.530 6.23e-09 ***
## s(cent_veg_cy)     7.037e+00      9  11.033  &lt; 2e-16 ***
## s(cent_veg_py)     7.187e-05      9   0.000    0.636    
## s(cent_veg_2py)    8.631e+00      9  86.335  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.573   Deviance explained = 57.8%
## fREML =  18985  Scale est. = 162.69    n = 4755</code></pre>
<pre class="r"><code>modP0 &lt;- mgcv::bam(pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modP0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  9.96081    0.01184   841.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## s(cent_aa_n)       8.3322896      9  81.621  &lt; 2e-16 ***
## s(cent_prev_aa_n)  0.8844714      9   0.804  0.00401 ** 
## s(cent_aspect_rad) 8.0913586      9  38.700  &lt; 2e-16 ***
## s(cent_slope)      5.1637986      9   3.940 1.86e-07 ***
## s(cent_elev)       7.8627956      9 188.694  &lt; 2e-16 ***
## s(cent_tpi)        6.2489269      9   6.646 2.13e-12 ***
## s(cent_prec_py)    1.9145746      9   2.501 6.46e-07 ***
## s(cent_gdd_py)     0.0002709      2   0.000 7.11e-07 ***
## s(cent_veg_cy)     7.1615003      9  30.931  &lt; 2e-16 ***
## s(cent_veg_py)     4.1688279      9  12.279  &lt; 2e-16 ***
## s(cent_veg_2py)    8.6554835      9  28.108  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.649   Deviance explained = 65.4%
## fREML = 5931.6  Scale est. = 0.66638   n = 4755</code></pre>
<pre class="r"><code>modP0_cent &lt;- mgcv::bam(pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modP0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## pro ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  9.96081    0.01184   841.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## s(cent_aa_n)       8.3322896      9  81.621  &lt; 2e-16 ***
## s(cent_prev_aa_n)  0.8844714      9   0.804  0.00401 ** 
## s(cent_aspect_rad) 8.0913586      9  38.700  &lt; 2e-16 ***
## s(cent_slope)      5.1637986      9   3.940 1.86e-07 ***
## s(cent_elev)       7.8627956      9 188.694  &lt; 2e-16 ***
## s(cent_tpi)        6.2489269      9   6.646 2.13e-12 ***
## s(cent_prec_py)    1.9145746      9   2.501 6.46e-07 ***
## s(cent_gdd_py)     0.0002709      2   0.000 7.11e-07 ***
## s(cent_veg_cy)     7.1615003      9  30.931  &lt; 2e-16 ***
## s(cent_veg_py)     4.1688279      9  12.279  &lt; 2e-16 ***
## s(cent_veg_2py)    8.6554835      9  28.108  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.649   Deviance explained = 65.4%
## fREML = 5931.6  Scale est. = 0.66638   n = 4755</code></pre>
<pre class="r"><code>modNR0 &lt;- mgcv::bam(NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modNR0)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  221.127      1.084     204   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df      F  p-value    
## s(cent_aa_n)       5.4568287      9 45.969  &lt; 2e-16 ***
## s(cent_prev_aa_n)  4.4828347      9  5.942 7.13e-12 ***
## s(cent_aspect_rad) 8.4667145      9 56.561  &lt; 2e-16 ***
## s(cent_slope)      1.0449367      9  2.439 1.40e-06 ***
## s(cent_elev)       8.2948532      9 83.386  &lt; 2e-16 ***
## s(cent_tpi)        5.7651510      9  6.319 4.90e-12 ***
## s(cent_prec_py)    0.0011405      9  0.000 4.77e-09 ***
## s(cent_gdd_py)     0.9794753      2 14.980 8.61e-09 ***
## s(cent_veg_cy)     7.3876353      9 15.309  &lt; 2e-16 ***
## s(cent_veg_py)     0.0006302      9  0.000    0.369    
## s(cent_veg_2py)    8.7609695      9 59.724  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.519   Deviance explained = 52.4%
## fREML =  27385  Scale est. = 5585.5    n = 4755</code></pre>
<pre class="r"><code>modNR0_cent &lt;- mgcv::bam(NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>summary(modNR0_cent)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## NR ~ s(cent_aa_n, bs = &quot;ts&quot;) + s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
##     s(cent_aspect_rad, bs = &quot;ts&quot;) + s(cent_slope, bs = &quot;ts&quot;) + 
##     s(cent_elev, bs = &quot;ts&quot;) + s(cent_tpi, bs = &quot;ts&quot;) + s(cent_prec_py, 
##     bs = &quot;ts&quot;) + s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + s(cent_veg_cy, 
##     bs = &quot;ts&quot;) + s(cent_veg_py, bs = &quot;ts&quot;) + s(cent_veg_2py, 
##     bs = &quot;ts&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  221.127      1.084     204   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df      F  p-value    
## s(cent_aa_n)       5.4568287      9 45.969  &lt; 2e-16 ***
## s(cent_prev_aa_n)  4.4828347      9  5.942 7.13e-12 ***
## s(cent_aspect_rad) 8.4667145      9 56.561  &lt; 2e-16 ***
## s(cent_slope)      1.0449367      9  2.439 1.40e-06 ***
## s(cent_elev)       8.2948532      9 83.386  &lt; 2e-16 ***
## s(cent_tpi)        5.7651510      9  6.319 4.90e-12 ***
## s(cent_prec_py)    0.0011405      9  0.000 4.77e-09 ***
## s(cent_gdd_py)     0.9794753      2 14.980 8.61e-09 ***
## s(cent_veg_cy)     7.3876353      9 15.309  &lt; 2e-16 ***
## s(cent_veg_py)     0.0006302      9  0.000    0.369    
## s(cent_veg_2py)    8.7609695      9 59.724  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.519   Deviance explained = 52.4%
## fREML =  27385  Scale est. = 5585.5    n = 4755</code></pre>
</div>
<div id="check-diagnostics-1" class="section level4">
<h4>Check Diagnostics</h4>
<p>For each model fit, the diagnostics are checked to assess the assumptions of each model. These include linearity, normality of residuals, homogeneity of variance, and independence.</p>
<p>First make a directory to save outputs.</p>
<pre class="r"><code>cwd &lt;- paste0(&quot;results/&quot;, field_name, &quot;/diagnostics&quot;)
if (!file.exists(cwd)) {
  dir.create(cwd)
}</code></pre>
<p>Look at yield models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/yld_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modY0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 32 iterations.
## Gradient range [-2.805723e-05,1.709306e-07]
## (score 18984.96 &amp; scale 162.6902).
## Hessian positive definite, eigenvalue range [1.08176e-05,2377.039].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.66e+00    0.62  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 4.53e+00    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.22e+00    0.99    0.18    
## s(cent_slope)      9.00e+00 5.44e+00    0.68  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.25e+00    0.94  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 5.34e+00    0.99    0.21    
## s(cent_prec_py)    9.00e+00 5.06e-03    0.67  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 9.75e-01    0.67  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.04e+00    1.02    0.94    
## s(cent_veg_py)     9.00e+00 7.19e-05    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.00e+00 8.63e+00    0.52  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modY0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 32 iterations.
## Gradient range [-2.805723e-05,1.709306e-07]
## (score 18984.96 &amp; scale 162.6902).
## Hessian positive definite, eigenvalue range [1.08176e-05,2377.039].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.66e+00    0.62  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 4.53e+00    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.22e+00    0.99    0.25    
## s(cent_slope)      9.00e+00 5.44e+00    0.68  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.25e+00    0.94  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 5.34e+00    0.99    0.23    
## s(cent_prec_py)    9.00e+00 5.06e-03    0.67  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 9.75e-01    0.67  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.04e+00    1.02    0.93    
## s(cent_veg_py)     9.00e+00 7.19e-05    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.00e+00 8.63e+00    0.52  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/yld_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modY0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 32 iterations.
## Gradient range [-2.805723e-05,1.709306e-07]
## (score 18984.96 &amp; scale 162.6902).
## Hessian positive definite, eigenvalue range [1.08176e-05,2377.039].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.66e+00    0.62  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 4.53e+00    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.22e+00    0.99    0.20    
## s(cent_slope)      9.00e+00 5.44e+00    0.68  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.25e+00    0.94  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 5.34e+00    0.99    0.24    
## s(cent_prec_py)    9.00e+00 5.06e-03    0.67  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 9.75e-01    0.67  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.04e+00    1.02    0.94    
## s(cent_veg_py)     9.00e+00 7.19e-05    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.00e+00 8.63e+00    0.52  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modY0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 32 iterations.
## Gradient range [-2.805723e-05,1.709306e-07]
## (score 18984.96 &amp; scale 162.6902).
## Hessian positive definite, eigenvalue range [1.08176e-05,2377.039].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.00e+00 5.66e+00    0.62  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00e+00 4.53e+00    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00e+00 8.22e+00    0.99    0.15    
## s(cent_slope)      9.00e+00 5.44e+00    0.68  &lt;2e-16 ***
## s(cent_elev)       9.00e+00 8.25e+00    0.94  &lt;2e-16 ***
## s(cent_tpi)        9.00e+00 5.34e+00    0.99    0.23    
## s(cent_prec_py)    9.00e+00 5.06e-03    0.67  &lt;2e-16 ***
## s(cent_gdd_py)     2.00e+00 9.75e-01    0.67  &lt;2e-16 ***
## s(cent_veg_cy)     9.00e+00 7.04e+00    1.02    0.90    
## s(cent_veg_py)     9.00e+00 7.19e-05    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.00e+00 8.63e+00    0.52  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Look at protein models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/pro_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modP0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 10 iterations.
## Gradient range [-2.100961e-05,3.610649e-05]
## (score 5931.645 &amp; scale 0.6663799).
## eigenvalue range [-3.611062e-05,2377.043].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.000000 8.332290    0.61  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.000000 0.884471    0.94  &lt;2e-16 ***
## s(cent_aspect_rad) 9.000000 8.091359    1.00    0.66    
## s(cent_slope)      9.000000 5.163799    0.69  &lt;2e-16 ***
## s(cent_elev)       9.000000 7.862796    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.000000 6.248927    1.00    0.60    
## s(cent_prec_py)    9.000000 1.914575    0.65  &lt;2e-16 ***
## s(cent_gdd_py)     2.000000 0.000271    0.65  &lt;2e-16 ***
## s(cent_veg_cy)     9.000000 7.161500    1.02    0.82    
## s(cent_veg_py)     9.000000 4.168828    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.000000 8.655483    0.54  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modP0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 10 iterations.
## Gradient range [-2.100961e-05,3.610649e-05]
## (score 5931.645 &amp; scale 0.6663799).
## eigenvalue range [-3.611062e-05,2377.043].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.000000 8.332290    0.61  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.000000 0.884471    0.94  &lt;2e-16 ***
## s(cent_aspect_rad) 9.000000 8.091359    1.00    0.58    
## s(cent_slope)      9.000000 5.163799    0.69  &lt;2e-16 ***
## s(cent_elev)       9.000000 7.862796    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.000000 6.248927    1.00    0.58    
## s(cent_prec_py)    9.000000 1.914575    0.65  &lt;2e-16 ***
## s(cent_gdd_py)     2.000000 0.000271    0.65  &lt;2e-16 ***
## s(cent_veg_cy)     9.000000 7.161500    1.02    0.92    
## s(cent_veg_py)     9.000000 4.168828    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.000000 8.655483    0.54  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/pro_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modP0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 10 iterations.
## Gradient range [-2.100961e-05,3.610649e-05]
## (score 5931.645 &amp; scale 0.6663799).
## eigenvalue range [-3.611062e-05,2377.043].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.000000 8.332290    0.61  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.000000 0.884471    0.94  &lt;2e-16 ***
## s(cent_aspect_rad) 9.000000 8.091359    1.00    0.61    
## s(cent_slope)      9.000000 5.163799    0.69  &lt;2e-16 ***
## s(cent_elev)       9.000000 7.862796    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.000000 6.248927    1.00    0.57    
## s(cent_prec_py)    9.000000 1.914575    0.65  &lt;2e-16 ***
## s(cent_gdd_py)     2.000000 0.000271    0.65  &lt;2e-16 ***
## s(cent_veg_cy)     9.000000 7.161500    1.02    0.90    
## s(cent_veg_py)     9.000000 4.168828    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.000000 8.655483    0.54  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modP0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-43-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 10 iterations.
## Gradient range [-2.100961e-05,3.610649e-05]
## (score 5931.645 &amp; scale 0.6663799).
## eigenvalue range [-3.611062e-05,2377.043].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                          k&#39;      edf k-index p-value    
## s(cent_aa_n)       9.000000 8.332290    0.61  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.000000 0.884471    0.94  &lt;2e-16 ***
## s(cent_aspect_rad) 9.000000 8.091359    1.00    0.65    
## s(cent_slope)      9.000000 5.163799    0.69  &lt;2e-16 ***
## s(cent_elev)       9.000000 7.862796    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.000000 6.248927    1.00    0.64    
## s(cent_prec_py)    9.000000 1.914575    0.65  &lt;2e-16 ***
## s(cent_gdd_py)     2.000000 0.000271    0.65  &lt;2e-16 ***
## s(cent_veg_cy)     9.000000 7.161500    1.02    0.90    
## s(cent_veg_py)     9.000000 4.168828    0.54  &lt;2e-16 ***
## s(cent_veg_2py)    9.000000 8.655483    0.54  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Look at net-return models.</p>
<pre class="r"><code>par(mfrow=c(2,2))
png(paste0(cwd, &quot;/NR_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)
  par(mfrow=c(2,2))
  mgcv::gam.check(modNR0)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 18 iterations.
## Gradient range [-6.690882e-05,0.0002442426]
## (score 27385.34 &amp; scale 5585.535).
## Hessian positive definite, eigenvalue range [1.912213e-05,2377.037].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 5.45683    0.60  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 4.48283    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 8.46671    1.00    0.36    
## s(cent_slope)      9.00000 1.04494    0.67  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.29485    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.00000 5.76515    0.99    0.20    
## s(cent_prec_py)    9.00000 0.00114    0.66  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.97947    0.66  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 7.38764    1.02    0.89    
## s(cent_veg_py)     9.00000 0.00063    0.52  &lt;2e-16 ***
## s(cent_veg_2py)    9.00000 8.76097    0.51  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modNR0)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 18 iterations.
## Gradient range [-6.690882e-05,0.0002442426]
## (score 27385.34 &amp; scale 5585.535).
## Hessian positive definite, eigenvalue range [1.912213e-05,2377.037].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 5.45683    0.60  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 4.48283    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 8.46671    1.00    0.42    
## s(cent_slope)      9.00000 1.04494    0.67  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.29485    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.00000 5.76515    0.99    0.17    
## s(cent_prec_py)    9.00000 0.00114    0.66  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.97947    0.66  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 7.38764    1.02    0.94    
## s(cent_veg_py)     9.00000 0.00063    0.52  &lt;2e-16 ***
## s(cent_veg_2py)    9.00000 8.76097    0.51  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>png(paste0(cwd, &quot;/NR_cent_diagnostics.png&quot;), 
    width = 10, 
    height = 10,
    units = &#39;in&#39;, 
    res = 100)  
  par(mfrow=c(2,2))
  mgcv::gam.check(modNR0_cent)</code></pre>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 18 iterations.
## Gradient range [-6.690882e-05,0.0002442426]
## (score 27385.34 &amp; scale 5585.535).
## Hessian positive definite, eigenvalue range [1.912213e-05,2377.037].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 5.45683    0.60  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 4.48283    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 8.46671    1.00    0.34    
## s(cent_slope)      9.00000 1.04494    0.67  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.29485    0.95  &lt;2e-16 ***
## s(cent_tpi)        9.00000 5.76515    0.99    0.23    
## s(cent_prec_py)    9.00000 0.00114    0.66  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.97947    0.66  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 7.38764    1.02    0.90    
## s(cent_veg_py)     9.00000 0.00063    0.52  &lt;2e-16 ***
## s(cent_veg_2py)    9.00000 8.76097    0.51  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>mgcv::gam.check(modNR0_cent)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-44-2.png" width="672" /></p>
<pre><code>## 
## Method: fREML   Optimizer: perf newton
## full convergence after 18 iterations.
## Gradient range [-6.690882e-05,0.0002442426]
## (score 27385.34 &amp; scale 5585.535).
## Hessian positive definite, eigenvalue range [1.912213e-05,2377.037].
## Model rank =  93 / 93 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                         k&#39;     edf k-index p-value    
## s(cent_aa_n)       9.00000 5.45683    0.60  &lt;2e-16 ***
## s(cent_prev_aa_n)  9.00000 4.48283    0.91  &lt;2e-16 ***
## s(cent_aspect_rad) 9.00000 8.46671    1.00   0.390    
## s(cent_slope)      9.00000 1.04494    0.67  &lt;2e-16 ***
## s(cent_elev)       9.00000 8.29485    0.95   0.005 ** 
## s(cent_tpi)        9.00000 5.76515    0.99   0.225    
## s(cent_prec_py)    9.00000 0.00114    0.66  &lt;2e-16 ***
## s(cent_gdd_py)     2.00000 0.97947    0.66  &lt;2e-16 ***
## s(cent_veg_cy)     9.00000 7.38764    1.02   0.930    
## s(cent_veg_py)     9.00000 0.00063    0.52  &lt;2e-16 ***
## s(cent_veg_2py)    9.00000 8.76097    0.51  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="update-models-1" class="section level4">
<h4>Update Models</h4>
<p>Although there seems to be some heavy left tails in the normal qq-plots and violations of homogeneity of variance, we remind ourselves that the ultimate goal of these models is to make the best prediction, not necessarily the best interpretations. However, we are going to address the violation of the assumption of independence, because data closer to each other are more related than data farther apart from each other.</p>
<p>To take spatial autocorrelation into account, a gaussian process basis prediction function is used on the product of latitude and longitude.</p>
<pre class="r"><code>modY1 &lt;- mgcv::bam(yld ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modY1_cent &lt;- mgcv::bam(yld ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modP1 &lt;- mgcv::bam(pro ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modP1_cent &lt;- mgcv::bam(pro ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modNR1 &lt;- mgcv::bam(NR ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
<pre class="r"><code>modNR1_cent &lt;- mgcv::bam(NR ~ s(x, y, bs = &quot;gp&quot;, m = 2) +
                    s(cent_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_prev_aa_n, bs = &quot;ts&quot;) + 
                    s(cent_aspect_rad, bs = &quot;ts&quot;) + 
                    s(cent_slope, bs = &quot;ts&quot;) +
                    s(cent_elev, bs = &quot;ts&quot;) +
                    s(cent_tpi, bs = &quot;ts&quot;) +
                    s(cent_prec_py, bs = &quot;ts&quot;) +
                    s(cent_gdd_py, k = 1, bs = &quot;ts&quot;) + 
                    s(cent_veg_cy, bs = &quot;ts&quot;) +
                    s(cent_veg_py, bs = &quot;ts&quot;) +
                    s(cent_veg_2py, bs = &quot;ts&quot;),
                  data = dt)</code></pre>
<pre><code>## Warning in smooth.construct.tp.smooth.spec(object, data, knots): basis dimension, k, increased to minimum possible</code></pre>
</div>
<div id="assess-models-1" class="section level4">
<h4>Assess Models</h4>
<p>To asses the predictive ability of each model, it is used to predict the response in the validation dataset. This allows us to calculate RMSE and make plots of the model fits compared to observed values.</p>
<pre class="r"><code>dv$gam_pred_yld &lt;- predict(modY1, dv)
dv$gam_pred_yld_cent &lt;- predict(modY1_cent, dv)
dv$gam_pred_pro &lt;- predict(modP1, dv)
dv$gam_pred_pro_cent &lt;- predict(modP1_cent, dv)
dv$gam_pred_NR &lt;- predict(modNR1, dv)
dv$gam_pred_NR_cent &lt;- predict(modNR1, dv)

plotVal(dv, &quot;yld&quot;, &quot;gam_pred_yld&quot;, field_name, year, modY1, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;yld&quot;, &quot;gam_pred_yld_cent&quot;, field_name, year, modY1_cent, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-2.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;pro&quot;, &quot;gam_pred_pro&quot;, field_name, year, modP1, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-3.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;pro&quot;, &quot;gam_pred_pro_cent&quot;, field_name, year, modP1_cent, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-4.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;NR&quot;, &quot;gam_pred_NR&quot;, field_name, year, modNR1, TRUE)</code></pre>
<pre><code>## Warning: Removed 27 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 27 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-5.png" width="672" /></p>
<pre class="r"><code>plotVal(dv, &quot;NR&quot;, &quot;gam_pred_NR_cent&quot;, field_name, year, modNR1_cent, TRUE)</code></pre>
<pre><code>## Warning: Removed 27 rows containing missing values (geom_point).

## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 27 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-46-6.png" width="672" /></p>
<p>Based on the fitted values, there does not appear to be any difference between models fit with raw or centered response variables, so raw values will be assessed. Now, plot the observed vs. predcited values and calculate RMSE.</p>
<pre class="r"><code>plotObsVPreds(dv, &quot;yld&quot;, &quot;gam_pred_yld&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;yld&quot;, &quot;gam_pred_yld_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-2.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;pro&quot;, &quot;gam_pred_pro&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-3.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;pro&quot;, &quot;gam_pred_pro_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-4.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;NR&quot;, &quot;gam_pred_NR&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-5.png" width="672" /></p>
<pre class="r"><code>plotObsVPreds(dv, &quot;NR&quot;, &quot;gam_pred_NR_cent&quot;, field_name, year, TRUE)</code></pre>
<p><img src="analysis_sec1east_files/figure-html/unnamed-chunk-47-6.png" width="672" /></p>
</div>
<div id="save-outputs-2" class="section level4">
<h4>Save Outputs</h4>
<p>Now that each model has been fit, the RMSE and AIC of each is recorded for further analysis and comparison between years and across years. Again, because centering the responses results in the exact same model fits, it is omitted.</p>
<pre class="r"><code>rmses &lt;- c(round(Metrics::rmse(na.omit(dv$yld), na.omit(dv$gam_pred_yld)), 4),
           round(Metrics::rmse(na.omit(dv$pro), na.omit(dv$gam_pred_pro)), 4),
           round(Metrics::rmse(na.omit(dv$NR), na.omit(dv$gam_pred_NR)), 4))
aics &lt;- c(AIC(modY0), AIC(modP0), AIC(modNR0))
forOutput &lt;- data.frame(rep(field_name, 3), rep(year, 3), rep(&quot;GAM&quot;, 3),
                        c(&quot;Yield&quot;, &quot;Protein&quot;, &quot;Net-Return&quot;), rmses, aics)
# EDIT
output[4:6, ] &lt;- forOutput</code></pre>
</div>
<div id="sensitivity-analysis-1" class="section level4">
<h4>Sensitivity Analysis</h4>
<p>To perform the sensitivity analysis, each variable is increased or decreased by 10%. The resulting mean prediction across the field for the response is recorded and compared against the mean responses without adjustment. Sensitivity is calculated as the absolute value of the difference between the mean response of the default minus the mean response in the adjusted setting, over the mean response in the default system, divided by 0.1.</p>
<p>Make tables to hold sensitivity analysis results.</p>
<pre class="r"><code>covars &lt;- c(&quot;aa_n&quot;, &quot;aspect_rad&quot;, &quot;slope&quot;, &quot;elev&quot;,
            &quot;tpi&quot;, &quot;prec_py&quot;, &quot;gdd_py&quot;, &quot;veg_cy&quot;,
            &quot;veg_py&quot;, &quot;veg_2py&quot;)

yldSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(yldSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
yldSensTab$ResponseVar &lt;- &quot;yld&quot;
yldSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
yldSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))

proSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(proSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
proSensTab$ResponseVar &lt;- &quot;pro&quot;
proSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
proSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))


NRSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(NRSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
NRSensTab$ResponseVar &lt;- &quot;NR&quot;
NRSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
NRSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))</code></pre>
<p>Run sensitivity analysis.</p>
<pre class="r"><code>yldSensTab &lt;- sensitivity(yldSensTab, &quot;yld&quot;, dv, modY1)
proSensTab &lt;- sensitivity(proSensTab, &quot;pro&quot;, dv, modP1)
NRSensTab &lt;- sensitivity(NRSensTab, &quot;NR&quot;, dv, modNR1)</code></pre>
<p>Repeat for centered data.</p>
<pre class="r"><code>covars &lt;- c(&quot;cent_aa_n&quot;, &quot;cent_aspect_rad&quot;, &quot;cent_slope&quot;, &quot;cent_elev&quot;,
            &quot;cent_tpi&quot;, &quot;cent_prec_py&quot;, &quot;cent_gdd_py&quot;, &quot;cent_veg_cy&quot;,
            &quot;cent_veg_py&quot;, &quot;cent_veg_2py&quot;)

centyldSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centyldSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centyldSensTab$ResponseVar &lt;- &quot;yld&quot;
centyldSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centyldSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))

centproSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centproSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centproSensTab$ResponseVar &lt;- &quot;pro&quot;
centproSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centproSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))


centNRSensTab &lt;- matrix(0, nrow = length(covars)*2 + 1, ncol = 5) %&gt;%
  as.data.frame()
names(centNRSensTab) &lt;- c(&quot;Parameter&quot;, &quot;Adjustment&quot;, &quot;MeanResp&quot;,
                       &quot;Sensitivity.value&quot;,&quot;Elasticity.value&quot;)
centNRSensTab$ResponseVar &lt;- &quot;NR&quot;
centNRSensTab$Parameter &lt;- c(&quot;Defaults&quot;, rep(covars, each = 2))
centNRSensTab$Adjustment &lt;- c(NA, rep(c(&quot;10&quot;, &quot;-10&quot;), length(covars)))</code></pre>
<p>Run sensitivity analysis.</p>
<pre class="r"><code>centyldSensTab &lt;- sensitivity(centyldSensTab, &quot;yld&quot;, dv, modY1_cent)
centproSensTab &lt;- sensitivity(centproSensTab, &quot;pro&quot;, dv, modP1_cent)
centNRSensTab &lt;- sensitivity(centNRSensTab, &quot;NR&quot;, dv, modNR1_cent)</code></pre>
</div>
<div id="save-outputs-3" class="section level4">
<h4>Save Outputs</h4>
<pre class="r"><code>sensTable &lt;- rbind(yldSensTab, proSensTab, NRSensTab)
sensTable$field &lt;- field_name
data.table::fwrite(sensTable,
                   paste0(&quot;results/&quot;, field_name, &quot;/&quot;, 
                          field_name, &quot;_sensTable_&quot;, year))
sensTable &lt;- rbind(centyldSensTab, centproSensTab, centNRSensTab)
sensTable$field &lt;- field_name
data.table::fwrite(sensTable,
                   paste0(&quot;results/&quot;, field_name, &quot;/&quot;, 
                          field_name, &quot;_sensTableCent_&quot;, year))</code></pre>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
